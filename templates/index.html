<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –ª–æ–≥ —Ñ–∞–π–ª–∞—Ö</title>
    <style>
        body {
            background-color: #2c3e50;
            color: #ecf0f1;
            font-family: 'Arial', sans-serif;
        }

        h1 {
            color: #3498db;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #34495e;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #2980b9;
            color: #ecf0f1;
        }

        tbody tr:hover {
            background-color: #34495e;
            cursor: pointer;
        }

        #summaryText {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            box-sizing: border-box;
        }

        button {
            margin-top: 5px;
            padding: 8px;
            background-color: #3498db;
            color: #ecf0f1;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #16364b;
        }

        #fileLabel {
            margin-top: 10px;
        }
        
        tbody tr:hover {
            background-color: #34495e;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        tbody tr.selected {
            background-color: #a76ee7;
        }
		
        td:first-child {
            max-width: 100ch;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            white-space: nowrap;
        }
        
        .lds-roller {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
        }

        .lds-roller div {
            animation: lds-roller 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            transform-origin: 40px 40px;
        }

        .lds-roller div:after {
            content: " ";
            display: block;
            position: absolute;
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #fff;
            margin: -4px 0 0 -4px;
        }

        .lds-roller div:nth-child(1) {
            animation-delay: -0.036s;
        }

        .lds-roller div:nth-child(1):after {
            top: 63px;
            left: 63px;
        }

        .lds-roller div:nth-child(2) {
            animation-delay: -0.072s;
        }

        .lds-roller div:nth-child(2):after {
            top: 68px;
            left: 56px;
        }

        .lds-roller div:nth-child(3) {
            animation-delay: -0.108s;
        }

        .lds-roller div:nth-child(3):after {
            top: 71px;
            left: 48px;
        }

        .lds-roller div:nth-child(4) {
            animation-delay: -0.144s;
        }

        .lds-roller div:nth-child(4):after {
            top: 72px;
            left: 40px;
        }

        .lds-roller div:nth-child(5) {
            animation-delay: -0.18s;
        }

        .lds-roller div:nth-child(5):after {
            top: 71px;
            left: 32px;
        }

        .lds-roller div:nth-child(6) {
            animation-delay: -0.216s;
        }

        .lds-roller div:nth-child(6):after {
            top: 68px;
            left: 24px;
        }

        .lds-roller div:nth-child(7) {
            animation-delay: -0.252s;
        }

        .lds-roller div:nth-child(7):after {
            top: 63px;
            left: 17px;
        }
        
        .lds-roller div:nth-child(8) {
            animation-delay: -0.288s;
        }

        .lds-roller div:nth-child(8):after {
            top: 56px;
            left: 12px;
        }

        @keyframes lds-roller {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .navbar {
            overflow: hidden;
            background-color: #333;
        }

        .navbar a {
            float: left;
            display: block;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        .navbar a:hover {
            background-color: #ddd;
            color: black;
        }
    </style>
</head>
<body>
    <h1>–ü–æ–∏—Å–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –ª–æ–≥ —Ñ–∞–π–ª–∞—Ö</h1>

    <div class="navbar">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/mass_operations">–ú–∞—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏</a>
    </div>

    <button onclick="reloadData()">
        üîÑ –ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å –ª–æ–≥
    </button>

    <div id="fileLabel"></div>
    <div id="lds-roller" style="display: none;"><div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>
    
    <table id="resultTable">
        <thead>
            <tr>
                <th>–°–æ–≤–ø–∞–¥–µ–Ω–∏—è</th>
                <th>rqUid</th>
                <th>–†–µ—à–µ–Ω–∏—è</th>
                <th>–¢–µ–≥</th>
                <th>sessionId</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <button onclick="addMatch()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    </button>
    
    <button onclick="addToSummary()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
    </button>
    
    <button onclick="addRqUid()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å rqUid
    </button>
    
    <button onclick="addRecommendationBBMO()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ë–ë–ú–û
    </button>
    
    <button onclick="addRecommendationRestart()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
    </button>
    
    <button onclick="copyTag()">
        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¢–ï–ì
    </button>
    
    <button onclick="copySolution()">
        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ç–æ–≥
    </button>

    <button onclick="reloadData()">
        üîÑ –ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å –ª–æ–≥
    </button>

    <!-- –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <textarea id="summaryText" rows="4" placeholder="–î–æ–±–∞–≤–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç—É —Ñ–æ—Ä–º—É —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ, –≤—ã–¥–µ–ª–∏–≤ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–æ–∫—É"></textarea>

    <script>
       function reloadData() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            document.getElementById('lds-roller').style.display = 'block';

            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            document.getElementById('fileLabel').innerText = "";
            var tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = "";
            document.getElementById('summaryText').value = "";

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('fileLabel').innerText = "–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π —Ñ–∞–π–ª: " + data.file_label;

                    var tableBody = document.getElementById('tableBody');
                    tableBody.innerHTML = "";

                    data.tree_data.forEach(function (row) {
                        var newRow = tableBody.insertRow();
                        var matchCell = newRow.insertCell(0);
                        matchCell.innerHTML = highlightMessage(row.–°–æ–≤–ø–∞–¥–µ–Ω–∏—è);
                        matchCell.title = row.–°–æ–≤–ø–∞–¥–µ–Ω–∏—è; // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç title

                        newRow.insertCell(1).innerText = row.rqUid; // rqUid
                        newRow.insertCell(2).innerText = row.–†–µ—à–µ–Ω–∏—è; // –†–µ—à–µ–Ω–∏—è
                        newRow.insertCell(3).innerText = row.–¢–µ–≥; // –¢–µ–≥
                        newRow.insertCell(4).innerText = row.sessionId; // sessionId

                        newRow.onclick = function () {
                            toggleRowSelection(this);
                        };
                    });

                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                    document.getElementById('lds-roller').style.display = 'none';

                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ accOpened
                    fetch('/accOpened')
                        .then(response => response.json())
                        .then(accOpenedData => {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é accOpened –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                            if (accOpenedData.accOpened) {
                                addTextToSummary("–°—á—ë—Ç –æ—Ç–∫—Ä—ã—Ç. ");
                            }
                        });
                });
        }

        function addTextToSummary(text) {
            var summaryText = document.getElementById('summaryText');
            summaryText.focus(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ textarea
            document.execCommand('insertText', false, text);
        }

        function toggleRowSelection(row) {
        var table = document.getElementById('resultTable');
        for (var i = 0; i < table.rows.length; i++) {
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–æ–∫
            table.rows[i].classList.remove('selected');
        }
        // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É
        row.classList.add('selected');
    }

        function addMatch() {
            // –í–∞—à –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            var selectedRow = getSelectedRow();
            if (selectedRow) {
                var selectedText = selectedRow.cells[0].innerText;
                document.getElementById('summaryText').value += selectedText + ' ';
            }
        }

        function addRqUid() {
            var selectedRow = getSelectedRow();
            if (selectedRow) {
                var selectedRqUid = selectedRow.cells[1].innerText; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ rqUid –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–æ –≤—Ç–æ—Ä–æ–π —è—á–µ–π–∫–µ
                document.getElementById('summaryText').value += selectedRqUid + ' ';
            }
        }

        function addToSummary() {
            // –í–∞—à –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–µ—à–µ–Ω–∏–µ
            var selectedRow = getSelectedRow();
            if (selectedRow) {
                var selectedSolution = selectedRow.cells[2].innerText;
                addTextToSummary(selectedSolution + ' ');
            }
        }

        function addRecommendationBBMO() {
            // –í–∞—à –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ë–ë–ú–û
            document.getElementById('summaryText').value += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ë–ë–ú–û –≤—Ä—É—á–Ω—É—é. ';
        }

        function addRecommendationRestart() {
            // –í–∞—à –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
            document.getElementById('summaryText').value += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞), –æ—á–∏—Å—Ç–∏–≤ –∫—É–∫–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é. ';
        }

        function copyTag() {
            // –í–∞—à –∫–æ–¥ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¢–ï–ì–ê
            var selectedRow = getSelectedRow();
            if (selectedRow) {
                var selectedTag = selectedRow.cells[3].innerText;
                navigator.clipboard.writeText(selectedTag);
            }
        }

        function copySolution() {
            // –í–∞—à –∫–æ–¥ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è
            var summaryText = document.getElementById('summaryText');
            summaryText.select();
            document.execCommand('copy');
        }

        function getSelectedRow() {
            var table = document.getElementById('resultTable');
            for (var i = 0; i < table.rows.length; i++) {
                if (table.rows[i].classList.contains('selected')) {
                    return table.rows[i];
                }
            }
            return null;
        }


        function highlightMessage(message) {
            if (message.includes('ERROR')) {
                return '<span style="color: red;">' + message + '</span>';
            } else if (message.includes('INFO')) {
                return '<span style="color: #00FF00;">' + message + '</span>';
            } else if (message.includes('WARN')) {
                return '<span style="color: yellow;">' + message + '</span>';
            } else {
                return message;
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // –ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            reloadData();
        });
    </script>
</body>
</html>
